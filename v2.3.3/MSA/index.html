<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MSA · MIToS</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>MIToS</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../Installation/">Installation</a></li><li><a class="toctext" href="../Example/">Example</a></li><li><span class="toctext">Modules</span><ul><li class="current"><a class="toctext" href>MSA</a><ul class="internal"><li><a class="toctext" href="#Features-1">Features</a></li><li><a class="toctext" href="#Contents-1">Contents</a></li><li><a class="toctext" href="#MSA-IO-1">MSA IO</a></li><li><a class="toctext" href="#MSA-Annotations-1">MSA Annotations</a></li><li><a class="toctext" href="#Editing-your-MSA-1">Editing your MSA</a></li><li><a class="toctext" href="#Column-and-sequence-mappings-1">Column and sequence mappings</a></li><li><a class="toctext" href="#Get-sequences-from-a-MSA-1">Get sequences from a MSA</a></li><li><a class="toctext" href="#Describing-your-MSA-1">Describing your MSA</a></li><li><a class="toctext" href="#Sequence-clustering-1">Sequence clustering</a></li></ul></li><li><a class="toctext" href="../Information/">Information</a></li><li><a class="toctext" href="../SIFTS/">SIFTS</a></li><li><a class="toctext" href="../PDB/">PDB</a></li><li><a class="toctext" href="../Pfam/">Pfam</a></li></ul></li><li><a class="toctext" href="../Scripts/">Scripts</a></li><li><span class="toctext">API</span><ul><li><a class="toctext" href="../MSA_API/">MSA</a></li><li><a class="toctext" href="../Information_API/">Information</a></li><li><a class="toctext" href="../SIFTS_API/">SIFTS</a></li><li><a class="toctext" href="../PDB_API/">PDB</a></li><li><a class="toctext" href="../Pfam_API/">Pfam</a></li><li><a class="toctext" href="../Utils_API/">Utils</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Modules</li><li><a href>MSA</a></li></ul><a class="edit-page" href="https://github.com/diegozea/MIToS.jl/blob/master/docs/src/MSA.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>MSA</span><a class="fa fa-bars" href="#"></a></div></header><div></div><h1><a class="nav-anchor" id="Module-MSA-1" href="#Module-MSA-1">MSA</a></h1><p>The MSA module of MIToS has utilities for working with Multiple Sequence Alignments of protein Sequences (MSA).  </p><pre><code class="language-julia">using MIToS.MSA # to load the MSA module</code></pre><h2><a class="nav-anchor" id="Features-1" href="#Features-1">Features</a></h2><ul><li><a href="#Reading-MSA-files-1"><strong>Read</strong></a> and <a href="#Writing-MSA-files-1"><strong>write</strong></a> MSAs in <code>Stockholm</code>, <code>FASTA</code>, <code>PIR</code> or <code>Raw</code> format.</li><li>Handle <a href="#MSA-Annotations-1"><strong>MSA annotations</strong></a>.</li><li><a href="#Editing-your-MSA-1"><strong>Edit the MSA</strong></a>, e.g. delete columns or sequences, change sequence order, shuffling...</li><li><a href="#Column-and-sequence-mappings-1"><strong>Keep track of positions</strong></a> and annotations after modifications on the MSA.</li><li><a href="#Describing-your-MSA-1"><strong>Describe an MSA</strong></a>, e.g. mean percent identity, sequence coverage, gap percentage...</li><li><a href="#Sequence-clustering-1"><strong>Sequence clustering</strong></a> with Hobohm I.</li></ul><h2><a class="nav-anchor" id="Contents-1" href="#Contents-1">Contents</a></h2><ul><li><a href="#Module-MSA-1">MSA</a></li><ul><li><a href="#Features-1">Features</a></li><li><a href="#Contents-1">Contents</a></li><li><a href="#MSA-IO-1">MSA IO</a></li><ul><li><a href="#Reading-MSA-files-1">Reading MSA files</a></li><li><a href="#Writing-MSA-files-1">Writing MSA files</a></li></ul><li><a href="#MSA-Annotations-1">MSA Annotations</a></li><li><a href="#Editing-your-MSA-1">Editing your MSA</a></li><ul><ul><li><a href="#Example:-Deleting-sequences-1">Example: Deleting sequences</a></li><li><a href="#Example:-Exporting-a-MSA-for-freecontact-(part-I)-1">Example: Exporting a MSA for freecontact (part I)</a></li></ul></ul><li><a href="#Column-and-sequence-mappings-1">Column and sequence mappings</a></li><ul><ul><li><a href="#Example:-Exporting-a-MSA-for-freecontact-(part-II)-1">Example: Exporting a MSA for freecontact (part II)</a></li></ul></ul><li><a href="#Get-sequences-from-a-MSA-1">Get sequences from a MSA</a></li><li><a href="#Describing-your-MSA-1">Describing your MSA</a></li><ul><ul><li><a href="#Example:-Plotting-gap-percentage-per-column-and-coverage-per-sequence-1">Example: Plotting gap percentage per column and coverage per sequence</a></li><li><a href="#Example:-Filter-sequences-per-coverage-and-columns-per-gap-fraction-1">Example: Filter sequences per coverage and columns per gap fraction</a></li><li><a href="#Example:-Plotting-the-percentage-of-identity-between-sequences-1">Example: Plotting the percentage of identity between sequences</a></li></ul></ul><li><a href="#Sequence-clustering-1">Sequence clustering</a></li><ul><ul><li><a href="#Example:-Reducing-redundancy-of-a-MSA-1">Example: Reducing redundancy of a MSA</a></li></ul></ul></ul></ul><h2><a class="nav-anchor" id="MSA-IO-1" href="#MSA-IO-1">MSA IO</a></h2><h3><a class="nav-anchor" id="Reading-MSA-files-1" href="#Reading-MSA-files-1">Reading MSA files</a></h3><p>The main function for reading MSA files in MIToS is <code>read</code> and it is defined in the <code>Utils</code> module. This function takes a filename/path as a first argument followed by other arguments. It opens the file and uses the arguments to call the <code>parse</code> function. <code>read</code> decides how to open the file, using the prefixes (e.g. https) and suffixes (i.e. extensions) of the file name, while <code>parse</code> does the actual parsing of the file. You can <code>read</code> <strong>gzipped files</strong> if they have the <code>.gz</code> extension and also urls pointing to a <strong>web file</strong>.   The second argument of <code>read</code> and <code>parse</code> is the file <code>FileFormat</code>. The supported MSA formats at the moment are <code>Stockholm</code>, <code>FASTA</code>, <code>PIR</code> (NBRF) and <code>Raw</code>.   For example, reading with MIToS the full Stockholm MSA of the family PF07388 using the Pfam RESTful interface will be:  </p><div><pre><code class="language-julia">using MIToS.MSA

read(&quot;http://pfam.xfam.org/family/PF07388/alignment/full&quot;, Stockholm)</code></pre><pre><code class="language-none">AnnotatedMultipleSequenceAlignment with 36 annotations : 14×459 Named Array{MIToS.MSA.Residue,2}
               Seq ╲ Col │  24   25   26   27   28  …  551  552  553  554  555
─────────────────────────┼────────────────────────────────────────────────────
A0A1S1T395_9RHIZ/224-427 │   -    -    -    -    -  …    -    -    -    -    -
M5A3D2_9ACTN/208-402     │   -    -    -    -    -       -    -    -    -    -
A0A1B8PI30_MORNO/200-434 │   -    -    -    -    -       -    -    -    -    -
A0A1W1V8Q8_9PAST/1-405   │   -    -    S    K    F       -    -    -    -    -
A0A0B0IGB5_9BACI/201-416 │   -    -    -    -    -       -    -    -    -    -
A0A0B0IGB5_9BACI/1-170   │   -    -    -    -    -       -    -    -    -    -
Q4W584_NEIMB/1-222       │   M    L    K    K    I       -    -    -    -    -
A0A1S1TKC5_9RHIZ/184-421 │   -    -    -    -    -       -    -    -    -    -
A0A1S1TKC5_9RHIZ/2-147   │   -    -    -    -    -       -    -    -    -    -
C5ZW53_9HELI/1-498       │   -    -    K    K    L       K    Y    L    Q    L
M5A3D2_9ACTN/2-157       │   -    -    -    -    -       -    -    -    -    -
A0A1B8PI30_MORNO/6-183   │   -    -    -    -    -       -    -    -    -    -
A0A157SWM6_9BORD/1-413   │   -    L    K    K    L       -    -    -    -    -
A0A1S1T395_9RHIZ/6-168   │   -    -    -    -    -  …    -    -    -    -    -</code></pre></div><p>The third (and optional) argument of <code>read</code> and <code>parse</code> is the output MSA type:  </p><ul><li><code>Matrix{Residue}</code> : It only contains the aligned sequences.  </li><li><code>MultipleSequenceAlignment</code> : It contains the aligned sequences and their</li></ul><p>names/identifiers.  </p><ul><li><code>AnnotatedMultipleSequenceAlignment</code> : It&#39;s the richest MIToS&#39; MSA format and it&#39;s the</li></ul><p>default. It includes the aligned sequences, their names and the MSA annotations.  </p><p>Example of <code>Matrix{Residue}</code> output using a <code>Stockholm</code> file as input:</p><div><pre><code class="language-julia">read(&quot;http://pfam.xfam.org/family/PF07388/alignment/full&quot;, Stockholm, Matrix{Residue})</code></pre><pre><code class="language-none">14×459 Array{MIToS.MSA.Residue,2}:
 -  -  -  -  -  -  -  -  -  -  -  -  -  …  -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  S  K  F  T  K  F  I  F  N  P  K     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -  …  -  -  -  -  -  -  -  -  -  -  -  -
 M  L  K  K  I  K  K  A  L  F  Q  P  K     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  K  K  L  S  G  L  M  Q  D  I  K     D  F  Q  K  Y  R  I  K  Y  L  Q  L
 -  -  -  -  -  -  -  -  -  -  -  -  -  …  -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -     -  -  -  -  -  -  -  -  -  -  -  -
 -  L  K  K  L  R  K  L  I  L  H  P  V     -  -  -  -  -  -  -  -  -  -  -  -
 -  -  -  -  -  -  -  -  -  -  -  -  -     -  -  -  -  -  -  -  -  -  -  -  -</code></pre></div><p>Because <code>read</code> calls <code>parse</code>, you should look into the documentation of <code>parse</code> to know the available keyword arguments. The optional keyword arguments of those functions are:  </p><ul><li><code>generatemapping</code> : If <code>generatemapping</code> is <code>true</code> (default: <code>false</code>), sequences and</li></ul><p>columns mappings are generated and saved in the MSA annotations. <strong>The default is <code>false</code> to not overwrite mappings by mistake when you read an annotated MSA file saved with MIToS.</strong>  </p><ul><li><code>useidcoordinates</code> : If <code>useidcoordinates</code> is <code>true</code> (default: <code>false</code>) and the names</li></ul><p>have the form <em>seqname/start-end</em>, MIToS uses this coordinates to generate sequence mappings. This is safe and useful with unmodified Pfam MSAs. <strong>Do not use it when reading an MSA saved with MIToS. MIToS deletes unaligned insert columns, therefore disrupts sequences that have them.</strong>  </p><ul><li><code>deletefullgaps</code> : Given that lowercase characters and dots are converted to gaps,</li></ul><p>unaligned insert columns in the MSA (derived from a HMM profile) are converted into full gap columns. <code>deletefullgaps</code> is <code>true</code> by default, deleting full gaps columns and therefore insert columns.  </p><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p><strong>If you want to keep the insert columns...</strong>  Use the keyword argument <code>keepinserts</code> to <code>true</code> in <code>read</code>/<code>parse</code>. This only works with an <code>AnnotatedMultipleSequenceAlignment</code> output. A column annotation (<code>&quot;Aligned&quot;</code>) is stored in the annotations, where insert columns are marked with <code>0</code> and aligned columns with <code>1</code>.  </p></div></div><p>When <code>read</code> returns an <code>AnnotatedMultipleSequenceAlignment</code>, it uses the MSA <code>Annotations</code> to keep track of performed modifications. To access these notes, use <code>printmodifications</code>:  </p><div><pre><code class="language-julia">msa = read(&quot;http://pfam.xfam.org/family/PF01565/alignment/full&quot;, Stockholm)

printmodifications(msa)</code></pre><pre><code class="language-none">-------------------
2018-12-28T14:22:22.948

deletefullgaps!  :  Deletes 861 columns full of gaps (inserts generate full gap columns on MIToS because lowercase and dots are not allowed)
-------------------
2018-12-28T14:22:23.23

filtercolumns! : 861 columns have been deleted.</code></pre></div><h3><a class="nav-anchor" id="Writing-MSA-files-1" href="#Writing-MSA-files-1">Writing MSA files</a></h3><p>Julia REPL shows MSAs as Matrices. If you want to print them in another format, you should use the <code>print</code> function with an MSA object as first argument and the <code>FileFormat</code> <code>FASTA</code>, <code>Stockholm</code>, <code>PIR</code> or <code>Raw</code> as second argument.  </p><div><pre><code class="language-julia">using MIToS.MSA

msa = read(&quot;http://pfam.xfam.org/family/PF16996/alignment/full&quot;, Stockholm) # reads a Stockholm MSA file

print(msa, FASTA) # prints msa in FASTA format</code></pre><pre><code class="language-none">&gt;U5P5G4_9STRE/5-59
KKDLFYKEVEGRMNALKRRSAEKEKATRSEKVNLTLNVVIGLVILLGVLLTLFRV
&gt;T0TMU0_9STRE/1-43
------------MEELKQKPITKEKETRGEKINKSFSIMLGLVIIIGLIFTLI--
&gt;A0A139NPI6_9STRE/5-59
-EDLFYKEVEGRMADLQQKAPEKEKKTGAERLNTLFSLALGLVILLGLLFTLLR-
&gt;A0A139NTT2_9STRE/3-57
KKDLFYKDVEQKLDSLKQGQPKKEKASLGEKLNKAFVIALGLVILIGLIFTLI--
&gt;T0TY77_9STRE/5-59
KKDLFYKEVEGRMESLKRRPAEKEKTTRSEKINVTFNVIIGLVILLGVIFTLFRV
&gt;A8AWV6_STRGC/3-57
KKDLFYKDIEGRLDELKHGRPKKEKASLGEKFNKAFVIALGLMILIGLIFTLIG-
&gt;A0A139NMD7_9STRE/4-59
KDDIFYKDIEGRMDELKRKPPKKEKKTRAERISTFFSVSLGLVILIGLLFTLFRI
&gt;A3CM62_STRSV/3-57
KKDLFYKDIEGRLDELKHGKPKKEKASLGENLNKAFVIVLGLMILIGLIFTLI--</code></pre></div><p>To save an MSA object to a file, use the <code>write</code> function. This function takes a filename as a first argument. If the filename ends with <code>.gz</code>, the output will be a compressed (gzipped) file. The next two arguments of <code>write</code> are passed to <code>print</code>, so <code>write</code> behaves as <code>print</code>.  </p><div><pre><code class="language-julia">write(&quot;msa.gz&quot;, msa, FASTA) # writes msa in FASTA format in a gzipped file</code></pre></div><h2><a class="nav-anchor" id="MSA-Annotations-1" href="#MSA-Annotations-1">MSA Annotations</a></h2><p>MSA annotations are based on the Stockholm format mark-ups. There are four types of annotations stored as dictionaries. All the annotations have a feature name as part of the key, which should be a single &quot;word&quot; (without spaces) and less than 50 characters long.  </p><ul><li><strong>File annotations</strong> : The annotations can contain either file or MSA information. They</li></ul><p>have feature names as keys and the values are strings (free text). Lines starting with <code>#=GF</code> in Stockholm format.  </p><ul><li><strong>Column annotations</strong> : They have feature names as keys and strings with exactly 1 char</li></ul><p>per column as values. Lines starting with <code>#=GC</code> in Stockholm format.  </p><ul><li><strong>Sequence annotations</strong> : The keys are tuples with the sequence name and the feature</li></ul><p>name. The values are free text (strings). Lines starting with <code>#=GS</code> in Stockholm format. Annotations in the <code>PIR</code>/NBRF format are also stored as sequence annotations. In particular, we use the names <code>&quot;Type&quot;</code> and <code>&quot;Title&quot;</code> to name the sequence type in the identifier line and the first comment line before the sequence in PIR files, respectively.  </p><ul><li><strong>Residue annotations</strong> : The keys are tuples with the sequence name and the feature</li></ul><p>name. The values are strings with exactly 1 char per column/residues. <code>#=GR</code> lines in Stockholm format.  </p><p>Julia REPL shows the <code>Annotations</code> type as they are represented in the <a href="https://en.wikipedia.org/wiki/Stockholm_format">Stockholm format<img src="../assets/external-link.png" alt/></a>. You can get the <code>Annotations</code> inside an annotated MSA or sequence using the <code>annotations</code> function.  </p><div><pre><code class="language-julia">annotations(msa)</code></pre><pre><code class="language-none">#=GF ID	Asp4
#=GF AC	PF16996.5
#=GF DE	Accessory secretory protein Sec Asp4
#=GF AU	Coggill P;0000-0001-5731-1588
#=GF SE	Pfam-B_7603 (release 27.0)
#=GF GA	25.70 25.70;
#=GF TC	55.00 54.80;
#=GF NC	21.60 20.60;
#=GF BM	hmmbuild HMM.ann SEED.ann
#=GF SM	hmmsearch -Z 45638612 -E 1000 --cpu 4 HMM pfamseq
#=GF TP	Family
#=GF RN	[1]
#=GF RM	23000954
#=GF RT	Emerging themes in SecA2-mediated protein export.
#=GF RA	Feltcher ME, Braunstein M;
#=GF RL	Nat Rev Microbiol. 2012;10:779-789.
#=GF DR	INTERPRO; IPR031551;
#=GF DR	SO; 0100021; polypeptide_conserved_region;
#=GF CC	Asp4 and Asp5 are putative accessory components of the SecY2
#=GF CC	channel of the SecA2-SecY2 mediated export system, but they are
#=GF CC	not present in all SecA2-SecY2 systems. This family of Asp4 is
#=GF CC	found in Firmicutes [1].
#=GF SQ	8
#=GF MIToS_2018-12-28T14:22:23.713	deletefullgaps!  :  Deletes 3 columns full of gaps (inserts generate full gap columns on MIToS because lowercase and dots are not allowed)
#=GF MIToS_2018-12-28T14:22:23.713	filtercolumns! : 3 columns have been deleted.
#=GS A3CM62_STRSV/3-57	AC	A3CM62.1
#=GS A0A139NTT2_9STRE/3-57	AC	A0A139NTT2.1
#=GS A0A139NMD7_9STRE/4-59	AC	A0A139NMD7.1
#=GS T0TMU0_9STRE/1-43	AC	T0TMU0.1
#=GS U5P5G4_9STRE/5-59	AC	U5P5G4.1
#=GS T0TY77_9STRE/5-59	AC	T0TY77.1
#=GS A0A139NPI6_9STRE/5-59	AC	A0A139NPI6.1
#=GS A8AWV6_STRGC/3-57	AC	A8AWV6.1
#=GC seq_cons			KKDLFYK-lEGRM--LK++sPcKEKsTtuEKlNpsFslsLGLVILIGLIFTLlt.</code></pre></div><p>Particular annotations can be accessed using the functions <code>getannot...</code>. These functions take the MSA/sequence as first argument and the feature name of the desired annotation as the last. In the case of <code>getannotsequence</code> and <code>getannotresidue</code>, the second argument should be the sequence name.  </p><div><pre><code class="language-julia">getannotsequence(msa, &quot;A0A139NPI6_9STRE/5-59&quot;, &quot;AC&quot;) # (&quot;A0A139NPI6_9STRE/5-59&quot;, &quot;AC&quot;) is the key in the dictionary</code></pre><pre><code class="language-none">&quot;A0A139NPI6.1&quot;</code></pre></div><p>If you want to add new annotations, you should use the <code>setannot…!</code> functions. These functions have the same arguments that <code>getannot...</code> functions except for an extra argument used to indicate the new annotation value.  </p><div><pre><code class="language-julia">setannotsequence!(msa, &quot;A0A139NPI6_9STRE/5-59&quot;, &quot;New_Feature_Name&quot;, &quot;New_Annotation&quot;)</code></pre><pre><code class="language-none">&quot;New_Annotation&quot;</code></pre></div><p>A <code>getannot...</code> function without the key (last arguments), returns the particular annotation dictionary. As you can see, the new sequence annotation is now part of our MSA annotations.  </p><div><pre><code class="language-julia">getannotsequence(msa)</code></pre><pre><code class="language-none">Dict{Tuple{String,String},String} with 9 entries:
  (&quot;A3CM62_STRSV/3-57&quot;, &quot;AC&quot;)                   =&gt; &quot;A3CM62.1&quot;
  (&quot;A0A139NTT2_9STRE/3-57&quot;, &quot;AC&quot;)               =&gt; &quot;A0A139NTT2.1&quot;
  (&quot;A0A139NMD7_9STRE/4-59&quot;, &quot;AC&quot;)               =&gt; &quot;A0A139NMD7.1&quot;
  (&quot;T0TMU0_9STRE/1-43&quot;, &quot;AC&quot;)                   =&gt; &quot;T0TMU0.1&quot;
  (&quot;U5P5G4_9STRE/5-59&quot;, &quot;AC&quot;)                   =&gt; &quot;U5P5G4.1&quot;
  (&quot;T0TY77_9STRE/5-59&quot;, &quot;AC&quot;)                   =&gt; &quot;T0TY77.1&quot;
  (&quot;A0A139NPI6_9STRE/5-59&quot;, &quot;AC&quot;)               =&gt; &quot;A0A139NPI6.1&quot;
  (&quot;A0A139NPI6_9STRE/5-59&quot;, &quot;New_Feature_Name&quot;) =&gt; &quot;New_Annotation&quot;
  (&quot;A8AWV6_STRGC/3-57&quot;, &quot;AC&quot;)                   =&gt; &quot;A8AWV6.1&quot;</code></pre></div><h2><a class="nav-anchor" id="Editing-your-MSA-1" href="#Editing-your-MSA-1">Editing your MSA</a></h2><p>MIToS offers functions to edit your MSA. Because these functions modify the msa, their names end with a bang <code>!</code>, following the Julia convention. Some of these functions have an <code>annotate</code> keyword argument (in general, it&#39;s <code>true</code> by default) to indicate if the modification should be recorded in the MSA/sequence annotations.  </p><p>One common task is to delete sequences or columns of the MSA. This could be done using the functions <code>filtersequences!</code> and <code>filtercolumns!</code>. These functions take the MSA or sequence (if it&#39;s possible) as first argument and a <code>BitVector</code> or <code>Vector{Bool}</code> mask as second argument. It deletes all the sequences or columns where the mask is <code>false</code>. These functions are also defined for <code>Annotations</code>, this allows to automatically update (modify) the annotations (and therefore, sequence and column mappings) in the MSA.  </p><p>This two deleting operations are used in the second and third mutating functions of the following list:  </p><ul><li><code>setreference!</code> : Sets one of the sequences as the first sequence of the MSA (query or</li></ul><p>reference sequence).  </p><ul><li><code>adjustreference!</code> : Deletes columns with gaps in the first sequence of the MSA</li></ul><p>(reference).  </p><ul><li><code>gapstrip!</code> : This function first calls <code>adjustreference!</code>, then deletes sequences with</li></ul><p>low (user defined) MSA coverage and finally, columns with user defined % of gaps.  </p><p>Also, there are several available funtions <code>shuffle_…!</code>. These functions are useful to generate random alignments. The <code>Information</code> module of <code>MIToS</code> uses them to calculate the Z scores of MI values.  </p><h4><a class="nav-anchor" id="Example:-Deleting-sequences-1" href="#Example:-Deleting-sequences-1">Example: Deleting sequences</a></h4><p>For example, if you want to keep only the proteins from <em>Actinobacteria</em> you can delete all the sequences that don&#39;t have <code>_9ACTN</code> in their UniProt entry names:  </p><div><pre><code class="language-julia">using MIToS.MSA

msa = read(&quot;http://pfam.xfam.org/family/PF07388/alignment/full&quot;, Stockholm)

sequencenames(msa) # the function sequencenames returns the sequence names in the MSA</code></pre><pre><code class="language-none">14-element Array{String,1}:
 &quot;A0A1S1T395_9RHIZ/224-427&quot;
 &quot;M5A3D2_9ACTN/208-402&quot;
 &quot;A0A1B8PI30_MORNO/200-434&quot;
 &quot;A0A1W1V8Q8_9PAST/1-405&quot;
 &quot;A0A0B0IGB5_9BACI/201-416&quot;
 &quot;A0A0B0IGB5_9BACI/1-170&quot;
 &quot;Q4W584_NEIMB/1-222&quot;
 &quot;A0A1S1TKC5_9RHIZ/184-421&quot;
 &quot;A0A1S1TKC5_9RHIZ/2-147&quot;
 &quot;C5ZW53_9HELI/1-498&quot;
 &quot;M5A3D2_9ACTN/2-157&quot;
 &quot;A0A1B8PI30_MORNO/6-183&quot;
 &quot;A0A157SWM6_9BORD/1-413&quot;
 &quot;A0A1S1T395_9RHIZ/6-168&quot;</code></pre></div><div><pre><code class="language-julia">mask = map(x -&gt; occursin(r&quot;_9ACTN&quot;, x), sequencenames(msa)) # an element of mask is true if &quot;_9ACTN&quot; is in the name</code></pre><pre><code class="language-none">14-element Array{Bool,1}:
 false
  true
 false
 false
 false
 false
 false
 false
 false
 false
  true
 false
 false
 false</code></pre></div><div><pre><code class="language-julia">filtersequences!(msa, mask) # deletes all the sequences where mask is false

sequencenames(msa)</code></pre><pre><code class="language-none">2-element Array{String,1}:
 &quot;M5A3D2_9ACTN/208-402&quot;
 &quot;M5A3D2_9ACTN/2-157&quot;</code></pre></div><h4><a class="nav-anchor" id="Example:-Exporting-a-MSA-for-freecontact-(part-I)-1" href="#Example:-Exporting-a-MSA-for-freecontact-(part-I)-1">Example: Exporting a MSA for freecontact (part I)</a></h4><p>The most simple input for the command line tool <a href="https://rostlab.org/owiki/index.php/FreeContact">freecontact<img src="../assets/external-link.png" alt/></a> (if you don&#39;t want to set <code>--mincontsep</code>) is a <code>Raw</code> MSA file with a reference sequence without insertions or gaps. This is easy to get with MIToS using <code>read</code> (deletes the insert columns), <code>setreference!</code> (to choose a reference), <code>adjustreference!</code> (to delete columns with gaps in the reference) and <code>write</code> (to save it in <code>Raw</code> format) functions.  </p><pre><code class="language-julia-repl">julia&gt; using MIToS.MSA

julia&gt; msa = read(&quot;http://pfam.xfam.org/family/PF02476/alignment/full&quot;, Stockholm)
AnnotatedMultipleSequenceAlignment with 41 annotations : 20×126 Named Array{MIToS.MSA.Residue,2}
               Seq ╲ Col │   9   10   11   12   13  …  205  206  207  208  209
─────────────────────────┼────────────────────────────────────────────────────
US02_GAHVM/120-237       │   M    L    E    S    E  …    F    C    C    -    -
A0A1R3T8S2_9ALPH/119-225 │   -    -    -    -    -       -    -    -    -    -
B1A4T1_9ALPH/119-238     │   H    L    S    S    G       A    C    C    I    -
A0A288CG55_EHV4/111-257  │   Y    L    N    S    S       F    C    Q    E    -
E2IUH4_SHV1/110-233      │   -    -    -    -    -       -    -    -    -    -
Q8V727_CHV1/110-256      │   -    L    C    E    P       P    C    V    A    C
A0A060Q503_9ALPH/110-250 │   -    L    H    G    P       S    C    P    A    -
Q77L60_MEHV1/120-238     │   M    L    E    S    E       L    C    C    C    -
US02_HHV11/110-247       │   -    L    H    R    D       P    C    C    A    C
⋮                            ⋮    ⋮    ⋮    ⋮    ⋮  ⋱    ⋮    ⋮    ⋮    ⋮    ⋮
A0A0Y0DAF2_9ALPH/108-249 │   -    -    -    -    -       -    -    -    -    -
A0A068EPE8_9ALPH/120-239 │   Y    L    E    S    G       L    C    C    -    -
US02_HHV2H/110-246       │   L    L    H    Q    E       P    C    F    T    C
J9R0A8_9ALPH/178-313     │   -    -    -    -    -       -    -    -    -    -
A0A0A7D914_9ALPH/111-268 │   H    L    N    S    S       T    A    -    -    -
Q67639_ILTV/100-201      │   H    L    S    S    G       -    -    -    -    -
Q6R5Q3_9ALPH/120-237     │   M    L    E    S    E       F    C    C    -    -
Q5PP72_9ALPH/135-256     │   Y    L    N    S    G       R    C    T    I    -
Q5EGY0_CHV16/111-255     │   -    L    C    D    P  …    P    C    T    A    C

julia&gt; msa_coverage = coverage(msa)
20×1 Named Array{Float64,2}
          Seq ╲ Function │ coverage
─────────────────────────┼─────────
US02_GAHVM/120-237       │ 0.904762
A0A1R3T8S2_9ALPH/119-225 │  0.65873
B1A4T1_9ALPH/119-238     │ 0.912698
A0A288CG55_EHV4/111-257  │ 0.960317
E2IUH4_SHV1/110-233      │ 0.801587
Q8V727_CHV1/110-256      │ 0.992063
A0A060Q503_9ALPH/110-250 │ 0.984127
Q77L60_MEHV1/120-238     │ 0.912698
US02_HHV11/110-247       │  0.97619
⋮                                 ⋮
A0A0Y0DAF2_9ALPH/108-249 │  0.65873
A0A068EPE8_9ALPH/120-239 │ 0.928571
US02_HHV2H/110-246       │ 0.984127
J9R0A8_9ALPH/178-313     │ 0.761905
A0A0A7D914_9ALPH/111-268 │ 0.960317
Q67639_ILTV/100-201      │ 0.325397
Q6R5Q3_9ALPH/120-237     │ 0.904762
Q5PP72_9ALPH/135-256     │ 0.880952
Q5EGY0_CHV16/111-255     │ 0.992063

julia&gt; maxcoverage, maxindex = findmax(msa_coverage) # chooses the sequence with more coverage of the MSA
(0.9920634920634921, CartesianIndex(6, 1))

julia&gt; setreference!(msa, maxindex[1])
AnnotatedMultipleSequenceAlignment with 42 annotations : 20×126 Named Array{MIToS.MSA.Residue,2}
               Seq ╲ Col │   9   10   11   12   13  …  205  206  207  208  209
─────────────────────────┼────────────────────────────────────────────────────
Q8V727_CHV1/110-256      │   -    L    C    E    P  …    P    C    V    A    C
A0A1R3T8S2_9ALPH/119-225 │   -    -    -    -    -       -    -    -    -    -
B1A4T1_9ALPH/119-238     │   H    L    S    S    G       A    C    C    I    -
A0A288CG55_EHV4/111-257  │   Y    L    N    S    S       F    C    Q    E    -
E2IUH4_SHV1/110-233      │   -    -    -    -    -       -    -    -    -    -
US02_GAHVM/120-237       │   M    L    E    S    E       F    C    C    -    -
A0A060Q503_9ALPH/110-250 │   -    L    H    G    P       S    C    P    A    -
Q77L60_MEHV1/120-238     │   M    L    E    S    E       L    C    C    C    -
US02_HHV11/110-247       │   -    L    H    R    D       P    C    C    A    C
⋮                            ⋮    ⋮    ⋮    ⋮    ⋮  ⋱    ⋮    ⋮    ⋮    ⋮    ⋮
A0A0Y0DAF2_9ALPH/108-249 │   -    -    -    -    -       -    -    -    -    -
A0A068EPE8_9ALPH/120-239 │   Y    L    E    S    G       L    C    C    -    -
US02_HHV2H/110-246       │   L    L    H    Q    E       P    C    F    T    C
J9R0A8_9ALPH/178-313     │   -    -    -    -    -       -    -    -    -    -
A0A0A7D914_9ALPH/111-268 │   H    L    N    S    S       T    A    -    -    -
Q67639_ILTV/100-201      │   H    L    S    S    G       -    -    -    -    -
Q6R5Q3_9ALPH/120-237     │   M    L    E    S    E       F    C    C    -    -
Q5PP72_9ALPH/135-256     │   Y    L    N    S    G       R    C    T    I    -
Q5EGY0_CHV16/111-255     │   -    L    C    D    P  …    P    C    T    A    C

julia&gt; adjustreference!(msa)
AnnotatedMultipleSequenceAlignment with 43 annotations : 20×125 Named Array{MIToS.MSA.Residue,2}
               Seq ╲ Col │  10   11   12   13   14  …  205  206  207  208  209
─────────────────────────┼────────────────────────────────────────────────────
Q8V727_CHV1/110-256      │   L    C    E    P    R  …    P    C    V    A    C
A0A1R3T8S2_9ALPH/119-225 │   -    -    -    -    -       -    -    -    -    -
B1A4T1_9ALPH/119-238     │   L    S    S    G    I       A    C    C    I    -
A0A288CG55_EHV4/111-257  │   L    N    S    S    I       F    C    Q    E    -
E2IUH4_SHV1/110-233      │   -    -    -    -    -       -    -    -    -    -
US02_GAHVM/120-237       │   L    E    S    E    V       F    C    C    -    -
A0A060Q503_9ALPH/110-250 │   L    H    G    P    R       S    C    P    A    -
Q77L60_MEHV1/120-238     │   L    E    S    E    A       L    C    C    C    -
US02_HHV11/110-247       │   L    H    R    D    Q       P    C    C    A    C
⋮                            ⋮    ⋮    ⋮    ⋮    ⋮  ⋱    ⋮    ⋮    ⋮    ⋮    ⋮
A0A0Y0DAF2_9ALPH/108-249 │   -    -    -    -    -       -    -    -    -    -
A0A068EPE8_9ALPH/120-239 │   L    E    S    G    I       L    C    C    -    -
US02_HHV2H/110-246       │   L    H    Q    E    R       P    C    F    T    C
J9R0A8_9ALPH/178-313     │   -    -    -    -    -       -    -    -    -    -
A0A0A7D914_9ALPH/111-268 │   L    N    S    S    L       T    A    -    -    -
Q67639_ILTV/100-201      │   L    S    S    G    A       -    -    -    -    -
Q6R5Q3_9ALPH/120-237     │   L    E    S    E    V       F    C    C    -    -
Q5PP72_9ALPH/135-256     │   L    N    S    G    A       R    C    T    I    -
Q5EGY0_CHV16/111-255     │   L    C    D    P    R  …    P    C    T    A    C

julia&gt; write(&quot;tofreecontact.msa&quot;, msa, Raw)

julia&gt; print(read(&quot;tofreecontact.msa&quot;, String)) # It displays the contents of the output file
LCEPRPRPRLYHLWVVGAADLCVPFLEHLRRARRLVTIRVTDAWAGGSWPLPDGLAVGETVPWTPFPTAHNHPLAALFGGYEYRYGVVRPGWLRETVPRLWPGSESAAAEAAKTPHPARRPCVAC
------QTDRFRLWIIGAADICQQALSSFPKNMRRITVKVNGEWPGNPCFLDTNLEPVLISSWKPVSWPEK-ENNIDTSKLLCRYELLIP-----------------------------------
LSSGILGNHTFDMWIIGAADICKPAIEQLPNSKRFITIKVPGTWSGLTWEKPDGLSPLTVTEWDPCDDETMSKIEKKLVGIKCCYDLIGQ----------PAAAKHNSELDDSKDCCNGPACCI-
LNSSIIINRPYHLWVLGAADLCRPVFNLIPGPKRIVYVEIEDEF-NKSW-QPSETIPLTTVDARSLLQHKSSFVSPPPNFKRLIYAVVDP--MRLQENLCPQITNRTKTKRRSKKTYNGLFCQE-
------DQRLFHVWIVGAADLCEPLLACLSTGARCVVIEIGGLWGGRSWLPPAYARSGASTSWTPLPPPTGSAAESALEGCEYRYAIIPG----VEARRRPASRDENDERS--------------
LESEVSGNAPHSLWIVGAADICRIALECIPLPKRLLAIKVSGTWSGMPWAIPDNIQTLLTSTWEPKFDTPEDRAHFCDSDMVCVYKILGS----------PPNPLKPPEIEPPQMTPGRLFCC--
LHGPRDRPRLYHMWVVGAADLCAPFLESLWRMRRLITIKIPDGWVGASWHLPEPFLPATSVAWTPFPAPPNHPLESLLQNYEYRYGILSPRWLRNLVNKWKNMGGRPTLPPATSEHITQNSCPA-
LESEASDNVSYSLWILGAADICRTAIESIPLPKRLFAIKVPGTWAGMPWAIPCEIQTLLTSTWEPKFENIEDKAYFNDSNMACVYQIIGS----------PPDVPQLQGLGIESTPPKRNLCCC-
LHRDQPSPRLYHLWVVGAADLCVPFLEYAQKIRRFIAIKTPDAWVGEPWAVPTRFLPEWTVAWTPFPAAPNHPLETLLSRYEYQYGVVLPRWLRSLIALHKPHPATPGPLTTSHP--VRRPCCAC
LNSGIFGNYPLNLWVFGAADLCEPVISNIPGPKRLIYAYVSCEWPEPSW-KPENVKHIDDSGWVPVLDTFLSSFKVPPMLSDIFYGTTFNTPFNFESSPRCPSISSSSSSSSSSS----SSC---
LNSSVMGNRPYHLWVFGAADICRPVFDLLPGPKRLVYAELSEEWPGPSW-QPPP-----AVPWTAPERGTPADLEVPPRVARMVYAVVNRSWLRSRPLRHVPGRATPATPSVSTP-SGRGRC---
--------KLYHMWVIGAADICDPFLSCLQQKARFITIKMDFIWEGAAWLPPPRMCPKKTVPWVPCPISQDPALEQLLSNCSYEYGVVGPR----------------------------------
LESGIMSGGPFSLWIIGAADLCKEAIEHIPTPKRMFALQVKGTWSGMPWAIPEAIPVLLESSWSPQFTHPLDQRGFLESGMRGVYKVIGR-------ASDPPRNNSEPETRKPRGRLLKYLCC--
LHQERPGPRLYHLWVVGAADLCVPFFEYAQKTRRFIATKTNDAWVGEPWPLPDRFLPERTVSWTPFPAAPNHPLENLLSRYEYQYGVVVPRWLRSLVAPHKPRPASSRPHPATHP--TQRPCFTC
--------ELFAVWVVGGADICAPAMEAMMALGRVVAIAGAHSLTGSSWPISARLLPAVWHSWEPYPAAPTNPLKNTFAACTFVAGTVNARWLGALTSHTRPQV---------------------
LNSSLIINQPYHLWVLGAADLCKPVFDLIPGPKRMVYAEIADEF-HKSW-QPPETIPWTTVEHNGFSKHSSNSLVHPPTVKRVIYAVVDPAPGRPRQRRRPSEGGMRAPRRRSRAAPARSTA---
LSSGAYAAKEFHLWVLGTADICMAALN-LPAPKTFLITETG------------------------------------------------------------------------------------
LESEVSGNAPHSLWIVGAADICRIALECIPLPKRLLAIKVSGTWSGMPWAIPDNIQTLLTSTWEPKFDTPEDRAHFCDSDMVCVYKILGS----------PPNPLKPPEIEPPQMTPGRLFCC--
LNSGARGTAPIHLWILGAADLCDQVLLAAS---RSTAAGAPGAPTGARLT---RRRPGLTDA------DALDVIVAGIPATRAMFARVHNEALHAQIVTRGDVRRRRGGRGNGRE--RAPRCTI-
LCDPRPRPRLYHLWVVGAADLCAPFLEHLRDGRRLVAVRVPDAWAGGSWPLPEGLALGETVPWTPFPTAHNHPLAALFGTYEYRYGVLRPGWLREAASRLWAGPPATATEAAQKRHPARRPCTAC</code></pre><h2><a class="nav-anchor" id="Column-and-sequence-mappings-1" href="#Column-and-sequence-mappings-1">Column and sequence mappings</a></h2><p>Inserts in a Stockholm MSA allow to access the full fragment of the aligned sequences. Using this, combined with the sequence names that contain coordinates used in Pfam, you can know what is the UniProt residue number of each residue in the MSA.   </p><pre><code class="language-julia">&quot;PROT_SPECI/3-15 .....insertALIGNED&quot;
#                     3456789111111
#                            012345</code></pre><p>MIToS <code>read</code> and <code>parse</code> functions delete the insert columns, but they do the mapping between each residue and its residue number before deleting insert columns when <code>generatemapping</code> is <code>true</code>. If you don&#39;t set <code>useidcoordinates</code> to <code>true</code>, the residue first <code>i</code> residue will be 1 instead of 3 in the previous example.  </p><div><pre><code class="language-julia">using MIToS.MSA

msa = parse(&quot;PROT_SPECI/3-15 .....insertALIGNED&quot;, Stockholm, generatemapping=true, useidcoordinates=true)</code></pre><pre><code class="language-none">AnnotatedMultipleSequenceAlignment with 5 annotations : 1×7 Named Array{MIToS.MSA.Residue,2}
      Seq ╲ Col │ 12  13  14  15  16  17  18
────────────────┼───────────────────────────
PROT_SPECI/3-15 │  A   L   I   G   N   E   D</code></pre></div><p>MIToS also keeps the column number of the input MSA and its total number of columns. All this data is stored in the MSA annotations using the <code>SeqMap</code>, <code>ColMap</code> and <code>NCol</code> feature names.  </p><div><pre><code class="language-julia">annotations(msa)</code></pre><pre><code class="language-none">#=GF NCol	18
#=GF ColMap	12,13,14,15,16,17,18
#=GF MIToS_2018-12-28T14:22:29.941	deletefullgaps!  :  Deletes 11 columns full of gaps (inserts generate full gap columns on MIToS because lowercase and dots are not allowed)
#=GF MIToS_2018-12-28T14:22:29.952	filtercolumns! : 11 columns have been deleted.
#=GS PROT_SPECI/3-15	SeqMap	9,10,11,12,13,14,15</code></pre></div><p>To have an easy access to mapping data, MIToS provides the <code>getsequencemapping</code> and <code>getcolumnmapping</code> functions.  </p><div><pre><code class="language-julia">getsequencemapping(msa, &quot;PROT_SPECI/3-15&quot;)</code></pre><pre><code class="language-none">7-element Array{Int64,1}:
  9
 10
 11
 12
 13
 14
 15</code></pre></div><div><pre><code class="language-julia">getcolumnmapping(msa)</code></pre><pre><code class="language-none">7-element Array{Int64,1}:
 12
 13
 14
 15
 16
 17
 18</code></pre></div><h4><a class="nav-anchor" id="Example:-Exporting-a-MSA-for-freecontact-(part-II)-1" href="#Example:-Exporting-a-MSA-for-freecontact-(part-II)-1">Example: Exporting a MSA for freecontact (part II)</a></h4><p>If we want to use the <code>--mincontsep</code> argument of <code>freecontact</code> to calculate scores between distant residues, we will need to add a header to the MSA. This header should contains the residue number of the first residue of the sequence and the full fragment of that sequence (with the inserts). This data is used by FreeContact to calculate the residue number of each residue in the reference sequence.   We are going to use MIToS mapping data to create this header, so we read the MSA with <code>generatemapping</code> and <code>useidcoordinates</code> set to <code>true</code>.  </p><div><pre><code class="language-julia">using MIToS.MSA

msa = read( &quot;http://pfam.xfam.org/family/PF02476/alignment/full&quot;, Stockholm,
            generatemapping=true, useidcoordinates=true)</code></pre><pre><code class="language-none">AnnotatedMultipleSequenceAlignment with 64 annotations : 20×126 Named Array{MIToS.MSA.Residue,2}
               Seq ╲ Col │   9   10   11   12   13  …  205  206  207  208  209
─────────────────────────┼────────────────────────────────────────────────────
US02_GAHVM/120-237       │   M    L    E    S    E  …    F    C    C    -    -
A0A1R3T8S2_9ALPH/119-225 │   -    -    -    -    -       -    -    -    -    -
B1A4T1_9ALPH/119-238     │   H    L    S    S    G       A    C    C    I    -
A0A288CG55_EHV4/111-257  │   Y    L    N    S    S       F    C    Q    E    -
E2IUH4_SHV1/110-233      │   -    -    -    -    -       -    -    -    -    -
Q8V727_CHV1/110-256      │   -    L    C    E    P       P    C    V    A    C
A0A060Q503_9ALPH/110-250 │   -    L    H    G    P       S    C    P    A    -
Q77L60_MEHV1/120-238     │   M    L    E    S    E       L    C    C    C    -
US02_HHV11/110-247       │   -    L    H    R    D       P    C    C    A    C
⋮                            ⋮    ⋮    ⋮    ⋮    ⋮  ⋱    ⋮    ⋮    ⋮    ⋮    ⋮
A0A0Y0DAF2_9ALPH/108-249 │   -    -    -    -    -       -    -    -    -    -
A0A068EPE8_9ALPH/120-239 │   Y    L    E    S    G       L    C    C    -    -
US02_HHV2H/110-246       │   L    L    H    Q    E       P    C    F    T    C
J9R0A8_9ALPH/178-313     │   -    -    -    -    -       -    -    -    -    -
A0A0A7D914_9ALPH/111-268 │   H    L    N    S    S       T    A    -    -    -
Q67639_ILTV/100-201      │   H    L    S    S    G       -    -    -    -    -
Q6R5Q3_9ALPH/120-237     │   M    L    E    S    E       F    C    C    -    -
Q5PP72_9ALPH/135-256     │   Y    L    N    S    G       R    C    T    I    -
Q5EGY0_CHV16/111-255     │   -    L    C    D    P  …    P    C    T    A    C</code></pre></div><p>Here, we are going to choose the sequence with more coverage of the MSA as our reference sequence.  </p><div><pre><code class="language-julia">msa_coverage = coverage(msa)
maxcoverage, maxindex = findmax(msa_coverage)
setreference!(msa, maxindex[1])
adjustreference!(msa)</code></pre><pre><code class="language-none">AnnotatedMultipleSequenceAlignment with 66 annotations : 20×125 Named Array{MIToS.MSA.Residue,2}
               Seq ╲ Col │  10   11   12   13   14  …  205  206  207  208  209
─────────────────────────┼────────────────────────────────────────────────────
Q8V727_CHV1/110-256      │   L    C    E    P    R  …    P    C    V    A    C
A0A1R3T8S2_9ALPH/119-225 │   -    -    -    -    -       -    -    -    -    -
B1A4T1_9ALPH/119-238     │   L    S    S    G    I       A    C    C    I    -
A0A288CG55_EHV4/111-257  │   L    N    S    S    I       F    C    Q    E    -
E2IUH4_SHV1/110-233      │   -    -    -    -    -       -    -    -    -    -
US02_GAHVM/120-237       │   L    E    S    E    V       F    C    C    -    -
A0A060Q503_9ALPH/110-250 │   L    H    G    P    R       S    C    P    A    -
Q77L60_MEHV1/120-238     │   L    E    S    E    A       L    C    C    C    -
US02_HHV11/110-247       │   L    H    R    D    Q       P    C    C    A    C
⋮                            ⋮    ⋮    ⋮    ⋮    ⋮  ⋱    ⋮    ⋮    ⋮    ⋮    ⋮
A0A0Y0DAF2_9ALPH/108-249 │   -    -    -    -    -       -    -    -    -    -
A0A068EPE8_9ALPH/120-239 │   L    E    S    G    I       L    C    C    -    -
US02_HHV2H/110-246       │   L    H    Q    E    R       P    C    F    T    C
J9R0A8_9ALPH/178-313     │   -    -    -    -    -       -    -    -    -    -
A0A0A7D914_9ALPH/111-268 │   L    N    S    S    L       T    A    -    -    -
Q67639_ILTV/100-201      │   L    S    S    G    A       -    -    -    -    -
Q6R5Q3_9ALPH/120-237     │   L    E    S    E    V       F    C    C    -    -
Q5PP72_9ALPH/135-256     │   L    N    S    G    A       R    C    T    I    -
Q5EGY0_CHV16/111-255     │   L    C    D    P    R  …    P    C    T    A    C</code></pre></div><p>MIToS deletes the residues in insert columns, so we are going to use the sequence mapping to generate the whole fragment of the reference sequence (filling the missing regions with <code>&#39;x&#39;</code>).  </p><div><pre><code class="language-julia">seqmap = getsequencemapping(msa, 1) # seqmap will be a vector with the residue numbers of the first sequence (reference)

seq = collect( stringsequence(msa, 1) ) # seq will be a Vector of Chars with the reference sequence

sequence = map(seqmap[1]:seqmap[end]) do seqpos # for each position in the whole fragment
    if seqpos in seqmap                         # if that position is in the MSA
        popfirst!(seq)                          # the residue is taken from seq
    else                                        # otherwise
        &#39;x&#39;                                     # &#39;x&#39; is included
    end
end

sequence = join(sequence) # join the Chars on the Vector to create a string</code></pre><pre><code class="language-none">&quot;LCEPRPRPRLYHLWVVGAADLCVPFLEHLRRARxxxRLVTIRVTDAWAxGGSWPLPDGLAVGETVPWTPFPTAHNHPLAALFGGYEYRYGVVRPxxxxxxxxxxxxxxGWLRETVPRLWPGSESAAAEAAKTPxxxHPARRPCVAC&quot;</code></pre></div><p>Once we have the whole fragment of the sequence, we create the file and write the header in the required format (as in the man page of freecontact).  </p><div><pre><code class="language-julia">open(&quot;tofreecontact.msa&quot;, &quot;w&quot;) do fh

    println(fh, &quot;# querystart=&quot;, seqmap[1])

    println(fh, &quot;# query=&quot;, sequence )

end</code></pre></div><p>As last (optional) argument, <code>write</code> takes the mode in which is opened the file. We use <code>&quot;a&quot;</code> here to append the MSA to the header.  </p><div><pre><code class="language-julia">write(&quot;tofreecontact.msa&quot;, msa, Raw, &quot;a&quot;)</code></pre></div><div><pre><code class="language-julia">print(read(&quot;tofreecontact.msa&quot;, String)) # It displays the contents of the output file</code></pre><pre><code class="language-none"># querystart=111
# query=LCEPRPRPRLYHLWVVGAADLCVPFLEHLRRARxxxRLVTIRVTDAWAxGGSWPLPDGLAVGETVPWTPFPTAHNHPLAALFGGYEYRYGVVRPxxxxxxxxxxxxxxGWLRETVPRLWPGSESAAAEAAKTPxxxHPARRPCVAC
LCEPRPRPRLYHLWVVGAADLCVPFLEHLRRARRLVTIRVTDAWAGGSWPLPDGLAVGETVPWTPFPTAHNHPLAALFGGYEYRYGVVRPGWLRETVPRLWPGSESAAAEAAKTPHPARRPCVAC
------QTDRFRLWIIGAADICQQALSSFPKNMRRITVKVNGEWPGNPCFLDTNLEPVLISSWKPVSWPEK-ENNIDTSKLLCRYELLIP-----------------------------------
LSSGILGNHTFDMWIIGAADICKPAIEQLPNSKRFITIKVPGTWSGLTWEKPDGLSPLTVTEWDPCDDETMSKIEKKLVGIKCCYDLIGQ----------PAAAKHNSELDDSKDCCNGPACCI-
LNSSIIINRPYHLWVLGAADLCRPVFNLIPGPKRIVYVEIEDEF-NKSW-QPSETIPLTTVDARSLLQHKSSFVSPPPNFKRLIYAVVDP--MRLQENLCPQITNRTKTKRRSKKTYNGLFCQE-
------DQRLFHVWIVGAADLCEPLLACLSTGARCVVIEIGGLWGGRSWLPPAYARSGASTSWTPLPPPTGSAAESALEGCEYRYAIIPG----VEARRRPASRDENDERS--------------
LESEVSGNAPHSLWIVGAADICRIALECIPLPKRLLAIKVSGTWSGMPWAIPDNIQTLLTSTWEPKFDTPEDRAHFCDSDMVCVYKILGS----------PPNPLKPPEIEPPQMTPGRLFCC--
LHGPRDRPRLYHMWVVGAADLCAPFLESLWRMRRLITIKIPDGWVGASWHLPEPFLPATSVAWTPFPAPPNHPLESLLQNYEYRYGILSPRWLRNLVNKWKNMGGRPTLPPATSEHITQNSCPA-
LESEASDNVSYSLWILGAADICRTAIESIPLPKRLFAIKVPGTWAGMPWAIPCEIQTLLTSTWEPKFENIEDKAYFNDSNMACVYQIIGS----------PPDVPQLQGLGIESTPPKRNLCCC-
LHRDQPSPRLYHLWVVGAADLCVPFLEYAQKIRRFIAIKTPDAWVGEPWAVPTRFLPEWTVAWTPFPAAPNHPLETLLSRYEYQYGVVLPRWLRSLIALHKPHPATPGPLTTSHP--VRRPCCAC
LNSGIFGNYPLNLWVFGAADLCEPVISNIPGPKRLIYAYVSCEWPEPSW-KPENVKHIDDSGWVPVLDTFLSSFKVPPMLSDIFYGTTFNTPFNFESSPRCPSISSSSSSSSSSS----SSC---
LNSSVMGNRPYHLWVFGAADICRPVFDLLPGPKRLVYAELSEEWPGPSW-QPPP-----AVPWTAPERGTPADLEVPPRVARMVYAVVNRSWLRSRPLRHVPGRATPATPSVSTP-SGRGRC---
--------KLYHMWVIGAADICDPFLSCLQQKARFITIKMDFIWEGAAWLPPPRMCPKKTVPWVPCPISQDPALEQLLSNCSYEYGVVGPR----------------------------------
LESGIMSGGPFSLWIIGAADLCKEAIEHIPTPKRMFALQVKGTWSGMPWAIPEAIPVLLESSWSPQFTHPLDQRGFLESGMRGVYKVIGR-------ASDPPRNNSEPETRKPRGRLLKYLCC--
LHQERPGPRLYHLWVVGAADLCVPFFEYAQKTRRFIATKTNDAWVGEPWPLPDRFLPERTVSWTPFPAAPNHPLENLLSRYEYQYGVVVPRWLRSLVAPHKPRPASSRPHPATHP--TQRPCFTC
--------ELFAVWVVGGADICAPAMEAMMALGRVVAIAGAHSLTGSSWPISARLLPAVWHSWEPYPAAPTNPLKNTFAACTFVAGTVNARWLGALTSHTRPQV---------------------
LNSSLIINQPYHLWVLGAADLCKPVFDLIPGPKRMVYAEIADEF-HKSW-QPPETIPWTTVEHNGFSKHSSNSLVHPPTVKRVIYAVVDPAPGRPRQRRRPSEGGMRAPRRRSRAAPARSTA---
LSSGAYAAKEFHLWVLGTADICMAALN-LPAPKTFLITETG------------------------------------------------------------------------------------
LESEVSGNAPHSLWIVGAADICRIALECIPLPKRLLAIKVSGTWSGMPWAIPDNIQTLLTSTWEPKFDTPEDRAHFCDSDMVCVYKILGS----------PPNPLKPPEIEPPQMTPGRLFCC--
LNSGARGTAPIHLWILGAADLCDQVLLAAS---RSTAAGAPGAPTGARLT---RRRPGLTDA------DALDVIVAGIPATRAMFARVHNEALHAQIVTRGDVRRRRGGRGNGRE--RAPRCTI-
LCDPRPRPRLYHLWVVGAADLCAPFLEHLRDGRRLVAVRVPDAWAGGSWPLPEGLALGETVPWTPFPTAHNHPLAALFGTYEYRYGVLRPGWLREAASRLWAGPPATATEAAQKRHPARRPCTAC</code></pre></div><h2><a class="nav-anchor" id="Get-sequences-from-a-MSA-1" href="#Get-sequences-from-a-MSA-1">Get sequences from a MSA</a></h2><p>It&#39;s possible to index the MSA as any other matrix to get an aligned sequence. This will be return a <code>Array</code> of <code>Residue</code>s without annotations but keeping names/identifiers.  </p><div><pre><code class="language-julia">using MIToS.MSA

msa = read( &quot;http://pfam.xfam.org/family/PF16996/alignment/full&quot;, Stockholm,
            generatemapping=true, useidcoordinates=true)</code></pre><pre><code class="language-none">AnnotatedMultipleSequenceAlignment with 39 annotations : 8×55 Named Array{MIToS.MSA.Residue,2}
            Seq ╲ Col │  2   3   4   5   6   7  …  51  52  53  54  55  56
──────────────────────┼──────────────────────────────────────────────────
U5P5G4_9STRE/5-59     │  K   K   D   L   F   Y  …   L   T   L   F   R   V
T0TMU0_9STRE/1-43     │  -   -   -   -   -   -      F   T   L   I   -   -
A0A139NPI6_9STRE/5-59 │  -   E   D   L   F   Y      F   T   L   L   R   -
A0A139NTT2_9STRE/3-57 │  K   K   D   L   F   Y      F   T   L   I   -   -
T0TY77_9STRE/5-59     │  K   K   D   L   F   Y      F   T   L   F   R   V
A8AWV6_STRGC/3-57     │  K   K   D   L   F   Y      F   T   L   I   G   -
A0A139NMD7_9STRE/4-59 │  K   D   D   I   F   Y      F   T   L   F   R   I
A3CM62_STRSV/3-57     │  K   K   D   L   F   Y  …   F   T   L   I   -   -</code></pre></div><div><pre><code class="language-julia">msa[2,:] # second sequence of the MSA, it keeps column names</code></pre><pre><code class="language-none">55-element Named Array{MIToS.MSA.Residue,1}
Col  │
─────┼──
2    │ -
3    │ -
4    │ -
5    │ -
6    │ -
7    │ -
8    │ -
9    │ -
10   │ -
⋮      ⋮
48   │ G
49   │ L
50   │ I
51   │ F
52   │ T
53   │ L
54   │ I
55   │ -
56   │ -</code></pre></div><div><pre><code class="language-julia">msa[2:2,:] # Using the range 2:2 to select the second sequence, keeping also the sequence name</code></pre><pre><code class="language-none">1×55 Named Array{MIToS.MSA.Residue,2}
        Seq ╲ Col │  2   3   4   5   6   7   8  …  50  51  52  53  54  55  56
──────────────────┼──────────────────────────────────────────────────────────
T0TMU0_9STRE/1-43 │  -   -   -   -   -   -   -  …   I   F   T   L   I   -   -</code></pre></div><p>If you want to obtain the aligned sequence with its name and annotations (and therefore sequence and column mappings), you should use the function <code>getsequence</code>. This function returns an <code>AlignedSequence</code> with the sequence name from a <code>MultipleSequenceAlignment</code> or an <code>AnnotatedAlignedSequence</code>, that also contains annotations, from an <code>AnnotatedMultipleSequenceAlignment</code>.  </p><div><pre><code class="language-julia">secondsequence = getsequence(msa, 2)</code></pre><pre><code class="language-none">AnnotatedAlignedSequence with 25 annotations : 1×55 Named Array{MIToS.MSA.Residue,2}
        Seq ╲ Col │  2   3   4   5   6   7   8  …  50  51  52  53  54  55  56
──────────────────┼──────────────────────────────────────────────────────────
T0TMU0_9STRE/1-43 │  -   -   -   -   -   -   -  …   I   F   T   L   I   -   -</code></pre></div><div><pre><code class="language-julia">annotations(secondsequence)</code></pre><pre><code class="language-none">#=GF ID	Asp4
#=GF AC	PF16996.5
#=GF DE	Accessory secretory protein Sec Asp4
#=GF AU	Coggill P;0000-0001-5731-1588
#=GF SE	Pfam-B_7603 (release 27.0)
#=GF GA	25.70 25.70;
#=GF TC	55.00 54.80;
#=GF NC	21.60 20.60;
#=GF BM	hmmbuild HMM.ann SEED.ann
#=GF SM	hmmsearch -Z 45638612 -E 1000 --cpu 4 HMM pfamseq
#=GF TP	Family
#=GF RN	[1]
#=GF RM	23000954
#=GF RT	Emerging themes in SecA2-mediated protein export.
#=GF RA	Feltcher ME, Braunstein M;
#=GF RL	Nat Rev Microbiol. 2012;10:779-789.
#=GF DR	INTERPRO; IPR031551;
#=GF DR	SO; 0100021; polypeptide_conserved_region;
#=GF CC	Asp4 and Asp5 are putative accessory components of the SecY2
#=GF CC	channel of the SecA2-SecY2 mediated export system, but they are
#=GF CC	not present in all SecA2-SecY2 systems. This family of Asp4 is
#=GF CC	found in Firmicutes [1].
#=GF SQ	8
#=GF NCol	58
#=GF ColMap	2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56
#=GF MIToS_2018-12-28T14:22:31.696	deletefullgaps!  :  Deletes 3 columns full of gaps (inserts generate full gap columns on MIToS because lowercase and dots are not allowed)
#=GF MIToS_2018-12-28T14:22:31.696	filtercolumns! : 3 columns have been deleted.
#=GS T0TMU0_9STRE/1-43	SeqMap	,,,,,,,,,,,,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,,
#=GS T0TMU0_9STRE/1-43	AC	T0TMU0.1
#=GC seq_cons			KKDLFYK-lEGRM--LK++sPcKEKsTtuEKlNpsFslsLGLVILIGLIFTLlt.</code></pre></div><p>Use <code>stringsequence</code> if you want to get the sequence as a string.  </p><div><pre><code class="language-julia">stringsequence(msa, 2)</code></pre><pre><code class="language-none">&quot;------------MEELKQKPITKEKETRGEKINKSFSIMLGLVIIIGLIFTLI--&quot;</code></pre></div><p>Because matrices are stored columnwise in Julia, you will find useful the <code>getresiduesequences</code> function when you need to heavily operate over sequences.  </p><div><pre><code class="language-julia">getresiduesequences(msa)</code></pre><pre><code class="language-none">8-element Array{Array{MIToS.MSA.Residue,1},1}:
 [K, K, D, L, F, Y, K, E, V, E  …  L, G, V, L, L, T, L, F, R, V]
 [-, -, -, -, -, -, -, -, -, -  …  I, G, L, I, F, T, L, I, -, -]
 [-, E, D, L, F, Y, K, E, V, E  …  L, G, L, L, F, T, L, L, R, -]
 [K, K, D, L, F, Y, K, D, V, E  …  I, G, L, I, F, T, L, I, -, -]
 [K, K, D, L, F, Y, K, E, V, E  …  L, G, V, I, F, T, L, F, R, V]
 [K, K, D, L, F, Y, K, D, I, E  …  I, G, L, I, F, T, L, I, G, -]
 [K, D, D, I, F, Y, K, D, I, E  …  I, G, L, L, F, T, L, F, R, I]
 [K, K, D, L, F, Y, K, D, I, E  …  I, G, L, I, F, T, L, I, -, -]</code></pre></div><h2><a class="nav-anchor" id="Describing-your-MSA-1" href="#Describing-your-MSA-1">Describing your MSA</a></h2><p>The MSA module has a number of functions to gain insight about your MSA. Using <code>MIToS.MSA</code>, one can easily ask for...  </p><ul><li>The <strong>number of columns and sequences</strong> with the <code>ncolumns</code> and <code>nsequences</code> functions.  </li><li>The fraction of columns with residues (<strong>coverage</strong>) for each sequence making use of the</li></ul><p><code>coverage</code> method.  </p><ul><li>The <strong>fraction or percentage of gaps/residues</strong> using with the functions <code>gapfraction</code>,</li></ul><p><code>residuefraction</code> and <code>columngapfraction</code>.  </p><ul><li>The <strong>percentage of identity</strong> (PID) between each sequence of the MSA or its mean value</li></ul><p>with <code>percentidentity</code> and <code>meanpercentidentity</code>.  </p><p>The percentage identity between two aligned sequences is a common measure of sequence similarity and is used by the <code>hobohmI</code> method to estimate and reduce MSA redundancy. <strong>MIToS functions to calculate percent identity don&#39;t align the sequences, they need already aligned sequences.</strong> Full gaps columns don&#39;t count to the alignment length.  </p><div><pre><code class="language-julia">using MIToS.MSA

msa = permutedims(
        hcat(   res&quot;--GGG-&quot;,      # res&quot;...&quot; uses the @res_str macro to create a (column) Vector{Residue}
                res&quot;---GGG&quot; ), (2,1))
#        identities 000110 sum 2
#  aligned residues 001111 sum 4</code></pre></div><div><pre><code class="language-julia">percentidentity(msa[1,:], msa[2,:]) # 2 / 4</code></pre><pre><code class="language-none">50.0</code></pre></div><p>To quickly calculate if the percentage of identity is greater than a determined value, use that threshold as third argument. <code>percentidentity(seqa, seqb, pid)</code> is a lot more faster than <code>percentidentity(seqa, seqb) &gt;= pid</code>.  </p><div><pre><code class="language-julia">percentidentity(msa[1,:], msa[2,:], 62) # 50% &gt;= 62%</code></pre><pre><code class="language-none">false</code></pre></div><h4><a class="nav-anchor" id="Example:-Plotting-gap-percentage-per-column-and-coverage-per-sequence-1" href="#Example:-Plotting-gap-percentage-per-column-and-coverage-per-sequence-1">Example: Plotting gap percentage per column and coverage per sequence</a></h4><p>The <code>gapfraction</code> and <code>coverage</code> functions return a vector of numbers between <code>0.0</code> and <code>1.0</code> (fraction of...). Sometime it&#39;s useful to plot this data to quickly understand the MSA structure. In this example, we are going to use the <a href="http://plots.readthedocs.org/en/latest/">Plots<img src="../assets/external-link.png" alt/></a> package for plotting, with the <a href="https://github.com/jheinen/GR.jl">GR<img src="../assets/external-link.png" alt/></a> backend, but you are free to use any of the Julia plotting libraries.  </p><div></div><div><pre><code class="language-julia">using MIToS.MSA

msa = read(&quot;http://pfam.xfam.org/family/PF09776/alignment/full&quot;, Stockholm)

using Plots

gr(size=(600,300))

plot(   1:ncolumns(msa), # x is a range from 1 to the number of columns
        vec(columngapfraction(msa)) .* 100.0, # y is a Vector{Float64} with the percentage of gaps of each column
        linetype = :line,
        ylabel = &quot;gaps [%]&quot;,
        xlabel = &quot;columns&quot;,
        legend=false)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_gaps.png" alt/>  </p><div><pre><code class="language-julia">plot(   1:nsequences(msa), # x is a range from 1 to the number of sequences
        vec(coverage(msa)) .* 100, # y is a Vector{Float64} with the coverage of each sequence
        linetype = :line,
        ylabel = &quot;coverage [%]&quot;,
        xlabel = &quot;sequences&quot;,
        legend=false)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_coverage.png" alt/>  </p><div><pre><code class="language-julia">plot(msa)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_msa.png" alt/>  </p><h4><a class="nav-anchor" id="Example:-Filter-sequences-per-coverage-and-columns-per-gap-fraction-1" href="#Example:-Filter-sequences-per-coverage-and-columns-per-gap-fraction-1">Example: Filter sequences per coverage and columns per gap fraction</a></h4><p>Taking advantage of the <code>filter...!</code> functions and the <code>coverage</code> and <code>columngapfraction</code> functions, it&#39;s possible to delete short sequences or columns with a lot of gaps.  </p><div><pre><code class="language-julia">println(&quot;\tsequences\tcolumns&quot;)
println( &quot;Before:\t&quot;, nsequences(msa), &quot;\t\t&quot;, ncolumns(msa)  )
# delete sequences with less than 90% coverage of the MSA length:
filtersequences!(msa, coverage(msa) .&gt;= 0.9)
# delete columns with more than 10% of gaps:
filtercolumns!(msa, columngapfraction(msa) .&lt;= 0.1)
println( &quot;After:\t&quot;, nsequences(msa), &quot;\t\t&quot;,  ncolumns(msa)  )</code></pre><pre><code class="language-none">	sequences	columns
Before:	251		116
After:	82		106</code></pre></div><div><pre><code class="language-julia">histogram(  vec(columngapfraction(msa)),
            # Using vec() to get a Vector{Float64} with the fraction of gaps of each column
            xlabel = &quot;gap fraction in [0,1]&quot;, bins = 20, legend = false)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_hist_gaps.png" alt/>  </p><div><pre><code class="language-julia">histogram(  vec(coverage(msa) .* 100.0), #  Column with the coverage of each sequence
            xlabel = &quot;coverage [%]&quot;, legend=false)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_hist_coverage.png" alt/>  </p><h4><a class="nav-anchor" id="Example:-Plotting-the-percentage-of-identity-between-sequences-1" href="#Example:-Plotting-the-percentage-of-identity-between-sequences-1">Example: Plotting the percentage of identity between sequences</a></h4><p>The distribution of the percentage of identity between every pair of sequences in an MSA, gives an idea of the MSA diversity. In this example, we are  using <code>percentidentity</code> over an MSA to get those identity values.  </p><div><pre><code class="language-julia">using MIToS.MSA
msa = read(&quot;http://pfam.xfam.org/family/PF09776/alignment/full&quot;, Stockholm)
pid = percentidentity(msa)</code></pre></div><p>MIToS stores the matrix of percentage of identity between the aligned sequences as a PairwiseListMatrix from the <a href="http://diegozea.github.io/PairwiseListMatrices.jl/">PairwiseListMatrices<img src="../assets/external-link.png" alt/></a> package. This matrix type saves RAM, allowing the storage of  big matrices. In this example, we use the <code>to_table</code> function of <em>PairwiseListMatrices</em> to convert the matrix into a table with indices.  </p><div><pre><code class="language-julia">using PairwiseListMatrices

pidtable = to_table(pid, diagonal=false)</code></pre><pre><code class="language-none">31375×3 Array{Any,2}:
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;G1RVK4_NOMLE/46-161&quot;       27.8261
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;A0A194PY65_PAPXU/3-116&quot;    40.5941
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;A0A0V0S2G9_9BILA/731-840&quot;  33.6634
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;A0A016T9R4_9BILA/3-89&quot;     45.9184
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;A0A1V4KDS6_PATFA/159-270&quot;  33.3333
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;M4A0G1_XIPMA/29-139&quot;       29.1262
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;A0A1B0BJN8_9MUSC/16-132&quot;   33.6634
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;A0A1I8N4P6_MUSDO/6-107&quot;    36.6337
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;A0A1U7TPR2_TARSY/10-125&quot;   23.4783
 &quot;A0A2A2LU69_9BILA/10-118&quot;  &quot;B4ILV0_DROSE/3-106&quot;        37.6238
 ⋮
 &quot;A0A2I3GIP3_NOMLE/10-125&quot;  &quot;RM55_MOUSE/9-124&quot;          73.2759
 &quot;A0A2I3GIP3_NOMLE/10-125&quot;  &quot;M3XPJ7_MUSPF/10-125&quot;       72.1739
 &quot;A0A2I3GIP3_NOMLE/10-125&quot;  &quot;A0A182GHC0_AEDAL/6-119&quot;    34.7826
 &quot;G3WPK1_SARHA/11-126&quot;      &quot;RM55_MOUSE/9-124&quot;          54.3103
 &quot;G3WPK1_SARHA/11-126&quot;      &quot;M3XPJ7_MUSPF/10-125&quot;       62.6087
 &quot;G3WPK1_SARHA/11-126&quot;      &quot;A0A182GHC0_AEDAL/6-119&quot;    40.8696
 &quot;RM55_MOUSE/9-124&quot;         &quot;M3XPJ7_MUSPF/10-125&quot;       70.6897
 &quot;RM55_MOUSE/9-124&quot;         &quot;A0A182GHC0_AEDAL/6-119&quot;    33.6207
 &quot;M3XPJ7_MUSPF/10-125&quot;      &quot;A0A182GHC0_AEDAL/6-119&quot;    35.6522</code></pre></div><p>The function <code>quantile</code> gives a quick idea of the percentage identity distribution of the MSA.  </p><div><pre><code class="language-julia">using Statistics

quantile(convert(Vector{Float64}, pidtable[:,3]), [0.00, 0.25, 0.50, 0.75, 1.00])</code></pre><pre><code class="language-none">5-element Array{Float64,1}:
   0.0
  28.07017543859649
  32.6530612244898
  39.130434782608695
 100.0</code></pre></div><p>The function <code>meanpercentidentity</code> gives the mean value of the percent identity distribution for MSA with less than 300 sequences, or a quick estimate (mean PID in a random sample of sequence pairs) otherwise unless you set <code>exact</code> to <code>true</code>.  </p><div><pre><code class="language-julia">meanpercentidentity(msa)</code></pre><pre><code class="language-none">35.41589479524384</code></pre></div><p>One can easily plot that matrix and its distribution using the <code>heatmap</code> and <code>histogram</code> functions of the <a href="https://github.com/tbreloff/Plots.jl">Plots<img src="../assets/external-link.png" alt/></a> package.  </p><div></div><div><pre><code class="language-julia">using Plots
gr()
heatmap(convert(Matrix, pid), yflip=true, ratio=:equal)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_heatmap_pid.png" alt/>  </p><div><pre><code class="language-julia">histogram(pidtable[:,3], xlabel =&quot;Percentage of identity&quot;, legend=false)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_hist_pid.png" alt/>  </p><h2><a class="nav-anchor" id="Sequence-clustering-1" href="#Sequence-clustering-1">Sequence clustering</a></h2><p>The <code>MSA</code> module allows to clusterize sequences in an MSA. The <code>hobohmI</code> function takes as input an MSA followed by an identity threshold value, and returns a <code>Clusters</code> type with the result of a <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2142204/">Hobohm I<img src="../assets/external-link.png" alt/></a> sequence clustering. The Hobohm I algorithm will add a sequence to an existing cluster, if the percentage of identity is equal or greater than the threshold.   The <code>Clusters</code> is sub-type of <code>ClusteringResult</code> from the <a href="http://clusteringjl.readthedocs.org/en/latest/index.html">Clustering.jl<img src="../assets/external-link.png" alt/></a> package. One advantage of use a sub-type of <code>ClusteringResult</code>is that you are able to use any method defined on <code>Clustering.jl</code> like <code>varinfo</code> (Variation of Information) for example. Also, you can use any clustering algorithm included in <em>Clustering.jl</em>, and convert its result to an <code>Clusters</code> object to use it with MIToS.   <code>MSA</code> defines the functions <code>nclusters</code> to get the resulting number of clusters, <code>counts</code> to get the number of sequences on each cluster and <code>assignments</code> to get the cluster number of each sequence. The most important method is <code>getweight</code>, which returns the weight of each sequence. This method is used in the <code>Information</code> module of MIToS to reduce redundancy.  </p><h4><a class="nav-anchor" id="Example:-Reducing-redundancy-of-a-MSA-1" href="#Example:-Reducing-redundancy-of-a-MSA-1">Example: Reducing redundancy of a MSA</a></h4><p>MSAs can suffer from an unnatural sequence redundancy and a high number of protein fragments. In this example, we are using a sequence clustering to make a non-redundant set of representative sequences. We are going to use the function <code>hobohmI</code> to perform the clustering with the Hobohm I algorithm at 62% identity.  </p><div></div><div><pre><code class="language-julia">using MIToS.MSA

msa = read(&quot;http://pfam.xfam.org/family/PF09776/alignment/full&quot;, Stockholm)

println(&quot;This MSA has &quot;, nsequences(msa), &quot; sequences...&quot;)</code></pre><pre><code class="language-none">This MSA has 251 sequences...</code></pre></div><div><pre><code class="language-julia">clusters = hobohmI(msa, 62)</code></pre><pre><code class="language-none">MIToS.MSA.Clusters([2, 50, 36, 2, 8, 5, 7, 3, 1, 2  …  1, 1, 1, 1, 2, 2, 1, 1, 2, 1], [1, 2, 3, 4, 5, 6, 7, 8, 3, 2  …  16, 3, 20, 3, 82, 2, 15, 2, 2, 3], [0.5, 0.02, 0.0277778, 0.5, 0.125, 0.2, 0.142857, 0.333333, 0.0277778, 0.02  …  0.25, 0.0277778, 0.0909091, 0.0277778, 1.0, 0.02, 0.333333, 0.02, 0.02, 0.0277778])</code></pre></div><div><pre><code class="language-julia">println(&quot;...but has only &quot;, nclusters(clusters), &quot; sequence clusters after a clustering at 62% identity.&quot;)</code></pre><pre><code class="language-none">...but has only 82 sequence clusters after a clustering at 62% identity.</code></pre></div><div><pre><code class="language-julia">using Plots
gr()

plot(msa)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_clusters_i.png" alt/>  </p><p>We are going to use the <a href="http://dataframesjl.readthedocs.org/en/latest/">DataFrames<img src="../assets/external-link.png" alt/></a> package to easily select the sequence with the highest coverage of each cluster.  </p><div><pre><code class="language-julia">using DataFrames

df = DataFrame( seqnum = 1:nsequences(msa),
                seqname = sequencenames(msa),
                cluster = assignments(clusters), # the cluster number/index of each sequence
                coverage = vec(coverage(msa)))</code></pre><table class="data-frame"><thead><tr><th></th><th>seqnum</th><th>seqname</th><th>cluster</th><th>coverage</th></tr><tr><th></th><th>Int64</th><th>String</th><th>Int64</th><th>Float64</th></tr></thead><tbody><p>251 rows × 4 columns</p><tr><th>1</th><td>1</td><td>A0A2A2LU69_9BILA/10-118</td><td>1</td><td>0.844828</td></tr><tr><th>2</th><td>2</td><td>G1RVK4_NOMLE/46-161</td><td>2</td><td>0.991379</td></tr><tr><th>3</th><td>3</td><td>A0A194PY65_PAPXU/3-116</td><td>3</td><td>0.793103</td></tr><tr><th>4</th><td>4</td><td>A0A0V0S2G9_9BILA/731-840</td><td>4</td><td>0.853448</td></tr><tr><th>5</th><td>5</td><td>A0A016T9R4_9BILA/3-89</td><td>5</td><td>0.62931</td></tr><tr><th>6</th><td>6</td><td>A0A1V4KDS6_PATFA/159-270</td><td>6</td><td>0.844828</td></tr><tr><th>7</th><td>7</td><td>M4A0G1_XIPMA/29-139</td><td>7</td><td>0.87069</td></tr><tr><th>8</th><td>8</td><td>A0A1B0BJN8_9MUSC/16-132</td><td>8</td><td>0.775862</td></tr><tr><th>9</th><td>9</td><td>A0A1I8N4P6_MUSDO/6-107</td><td>3</td><td>0.775862</td></tr><tr><th>10</th><td>10</td><td>A0A1U7TPR2_TARSY/10-125</td><td>2</td><td>0.991379</td></tr><tr><th>11</th><td>11</td><td>B4ILV0_DROSE/3-106</td><td>3</td><td>0.775862</td></tr><tr><th>12</th><td>12</td><td>G3SRJ5_LOXAF/9-123</td><td>2</td><td>0.991379</td></tr><tr><th>13</th><td>13</td><td>A0A0L8FVE8_OCTBM/8-111</td><td>9</td><td>0.818966</td></tr><tr><th>14</th><td>14</td><td>W4XCA5_STRPU/9-121</td><td>10</td><td>0.887931</td></tr><tr><th>15</th><td>15</td><td>RM55_HUMAN/10-125</td><td>2</td><td>0.991379</td></tr><tr><th>16</th><td>16</td><td>A0A1U8D4J6_MESAU/9-124</td><td>2</td><td>1.0</td></tr><tr><th>17</th><td>17</td><td>A0A1A9VR26_GLOAU/4-110</td><td>3</td><td>0.784483</td></tr><tr><th>18</th><td>18</td><td>C4WSU2_ACYPI/3-101</td><td>11</td><td>0.775862</td></tr><tr><th>19</th><td>19</td><td>B0WMT9_CULQU/8-116</td><td>12</td><td>0.827586</td></tr><tr><th>20</th><td>20</td><td>A0A182TGF7_9DIPT/27-135</td><td>12</td><td>0.784483</td></tr><tr><th>21</th><td>21</td><td>A0A1I7TQ78_9PELO/1-113</td><td>13</td><td>0.965517</td></tr><tr><th>22</th><td>22</td><td>G1TZ81_RABIT/10-122</td><td>14</td><td>0.965517</td></tr><tr><th>23</th><td>23</td><td>G3WPK0_SARHA/10-125</td><td>15</td><td>0.991379</td></tr><tr><th>24</th><td>24</td><td>A0A226ND80_CALSU/6-88</td><td>16</td><td>0.706897</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table></div><p>It is possible to use this <code>DataFrame</code> and <code>Plots</code> to plot the sequence coverage of the MSA and also an histogram of the number of sequences in each cluster:  </p><div><pre><code class="language-julia">using StatPlots # Plotting DataFrames
h = @df df histogram(:cluster, ylabel=&quot;nseq&quot;)
p = @df df plot(:cluster, :coverage, linetype=:scatter)
plot(p, h, nc=1, xlim=(0, nclusters(clusters)+1 ), legend=false)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_clusters_ii.png" alt/>  </p><p>We use the <em>Split-Apply-Combine</em> strategy, though the <code>by</code> function of the <code>DataFrames</code> package, to select the sequence of highest coverage for each cluster.  </p><div><pre><code class="language-julia">maxcoverage = by(df, :cluster, cl -&gt; cl[ findmax(cl[:coverage])[2] ,
                 [:seqnum, :seqname, :coverage]])</code></pre><table class="data-frame"><thead><tr><th></th><th>cluster</th><th>seqnum</th><th>seqname</th><th>coverage</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>String</th><th>Float64</th></tr></thead><tbody><p>82 rows × 4 columns</p><tr><th>1</th><td>1</td><td>1</td><td>A0A2A2LU69_9BILA/10-118</td><td>0.844828</td></tr><tr><th>2</th><td>2</td><td>16</td><td>A0A1U8D4J6_MESAU/9-124</td><td>1.0</td></tr><tr><th>3</th><td>3</td><td>210</td><td>A0A067RHM1_ZOONE/8-126</td><td>0.844828</td></tr><tr><th>4</th><td>4</td><td>206</td><td>A0A0V0TDB0_9BILA/725-833</td><td>0.862069</td></tr><tr><th>5</th><td>5</td><td>176</td><td>A0A0R3PMB8_ANGCS/12-119</td><td>0.818966</td></tr><tr><th>6</th><td>6</td><td>220</td><td>A0A218UFN6_9PASE/5-115</td><td>0.87069</td></tr><tr><th>7</th><td>7</td><td>224</td><td>A0A087Y3U8_POEFO/26-139</td><td>0.905172</td></tr><tr><th>8</th><td>8</td><td>134</td><td>A0A1B0G6D5_GLOMM/2-110</td><td>0.818966</td></tr><tr><th>9</th><td>9</td><td>13</td><td>A0A0L8FVE8_OCTBM/8-111</td><td>0.818966</td></tr><tr><th>10</th><td>10</td><td>14</td><td>W4XCA5_STRPU/9-121</td><td>0.887931</td></tr><tr><th>11</th><td>11</td><td>18</td><td>C4WSU2_ACYPI/3-101</td><td>0.775862</td></tr><tr><th>12</th><td>12</td><td>71</td><td>Q177J1_AEDAE/2-112</td><td>0.87069</td></tr><tr><th>13</th><td>13</td><td>21</td><td>A0A1I7TQ78_9PELO/1-113</td><td>0.965517</td></tr><tr><th>14</th><td>14</td><td>22</td><td>G1TZ81_RABIT/10-122</td><td>0.965517</td></tr><tr><th>15</th><td>15</td><td>23</td><td>G3WPK0_SARHA/10-125</td><td>0.991379</td></tr><tr><th>16</th><td>16</td><td>181</td><td>A0A1D5PF37_CHICK/13-125</td><td>0.922414</td></tr><tr><th>17</th><td>17</td><td>170</td><td>A0A0R3SVQ2_HYMDI/1-110</td><td>0.896552</td></tr><tr><th>18</th><td>18</td><td>116</td><td>A0A0N4SYK1_BRUPA/6-118</td><td>0.922414</td></tr><tr><th>19</th><td>19</td><td>41</td><td>K7FVJ9_PELSI/10-124</td><td>0.982759</td></tr><tr><th>20</th><td>20</td><td>140</td><td>E2AMM9_CAMFO/352-464</td><td>0.862069</td></tr><tr><th>21</th><td>21</td><td>31</td><td>A0A0M3IY57_ANISI/12-103</td><td>0.62069</td></tr><tr><th>22</th><td>22</td><td>32</td><td>A0A1I7XRJ6_HETBA/24-82</td><td>0.37931</td></tr><tr><th>23</th><td>23</td><td>38</td><td>A0A1S3T723_SALSA/16-92</td><td>0.646552</td></tr><tr><th>24</th><td>24</td><td>77</td><td>A0A0P7WDW8_9TELE/6-121</td><td>1.0</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table></div><div><pre><code class="language-julia">p = @df maxcoverage plot(:cluster, :coverage, linetype=:scatter)
h = @df maxcoverage histogram(:cluster, ylabel=&quot;nseq&quot;)
plot(p, h, nc=1, xlim=(0, nclusters(clusters)+1 ), legend=false)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_clusters_iii.png" alt/>  </p><p>We can easily generate a mask using list comprehension, to select only the representative sequences of the MSA (deleting the rest of the sequences with <code>filtersequences!</code>).  </p><div><pre><code class="language-julia">cluster_references = Bool[ seqnum in maxcoverage[:seqnum] for seqnum in 1:nsequences(msa) ]</code></pre><pre><code class="language-none">251-element Array{Bool,1}:
  true
 false
 false
 false
 false
 false
 false
 false
 false
 false
     ⋮
 false
 false
 false
  true
 false
 false
 false
 false
 false</code></pre></div><div><pre><code class="language-julia">filtersequences!(msa, cluster_references)</code></pre><pre><code class="language-none">AnnotatedMultipleSequenceAlignment with 106 annotations : 82×116 Named Array{MIToS.MSA.Residue,2}
                 Seq ╲ Col │  35   36   37   38   39  …  183  184  185  186  187
───────────────────────────┼────────────────────────────────────────────────────
A0A2A2LU69_9BILA/10-118    │   -    -    -    -    -  …    K    L    -    -    -
A0A0L8FVE8_OCTBM/8-111     │   -    -    -    -    -       H    L    W    K    K
W4XCA5_STRPU/9-121         │   -    -    -    -    -       H    L    W    N    K
A0A1U8D4J6_MESAU/9-124     │   L    L    R    H    C       Q    F    W    T    K
C4WSU2_ACYPI/3-101         │   -    -    -    -    -       K    Y    F    K    K
A0A1I7TQ78_9PELO/1-113     │   M    N    T    Q    I       K    F    W    S    -
G1TZ81_RABIT/10-122        │   L    L    W    Q    T       W    V    W    N    -
G3WPK0_SARHA/10-125        │   -    L    Q    Q    N       K    F    W    K    K
A0A0M3IY57_ANISI/12-103    │   -    -    -    -    -       -    -    -    -    -
⋮                              ⋮    ⋮    ⋮    ⋮    ⋮  ⋱    ⋮    ⋮    ⋮    ⋮    ⋮
A0A067RHM1_ZOONE/8-126     │   -    -    -    -    -       H    L    L    K    -
A0A1D2MP76_ORCCI/27-138    │   -    -    -    -    -       K    L    V    K    K
A0A0B2V267_TOXCA/8-119     │   -    -    -    -    -       Q    L    W    K    -
A0A218UFN6_9PASE/5-115     │   -    -    -    -    -       K    F    W    K    K
A0A1W4XV80_AGRPL/2-113     │   -    -    -    -    -       K    Y    I    K    K
A0A087Y3U8_POEFO/26-139    │   -    -    -    -    -       H    L    W    K    K
H3DW02_PRIPA/2-128         │   -    -    -    -    -       S    -    -    -    -
X6R631_HUMAN/1-52          │   -    -    -    -    -       Q    F    W    T    R
T1FXF3_HELRO/1-90          │   -    -    -    -    -  …    Y    L    W    K    K</code></pre></div><div><pre><code class="language-julia">plot(msa)</code></pre><pre><code class="language-none">/home/travis/.julia/packages/GR/wFd9A/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre></div><p><img src="../msa_clusters_iv.png" alt/>  </p><footer><hr/><a class="previous" href="../Example/"><span class="direction">Previous</span><span class="title">Example</span></a><a class="next" href="../Information/"><span class="direction">Next</span><span class="title">Information</span></a></footer></article></body></html>
